/*!CK:4180004272!*//*1378302385,178146589*/

if (self.CavalryLogger) { CavalryLogger.start_js(["\/qhGP"]); }

__d("PluginReturn",["Arbiter","Log","PlatformDialog","Plugin","URI","invariant"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('Log'),i=b('PlatformDialog'),j=b('Plugin'),k=b('URI'),l=b('invariant');g.subscribe(i.RESPONSE,function(event,n){if(n.error_code){h.debug('Plugin Return Error (%s): %s',n.error_code,n.error_message||n.error_description);return;}j.reload(n.plugin_reload);});var m={auto:function(){g.subscribe(j.RELOAD,function(event,n){m.reload(n);});},reload:function(n){var o=k.getRequestURI().removeQueryData('ret').removeQueryData('act').removeQueryData('hash');if(n){var p=new k(n);l(p.getPath().match(/^\/plugins\//));o.setPath(p.getPath()).addQueryData(p.getQueryData());}window.location.replace(o.toString());}};e.exports=m;});
__d("PluginLoginButton",["Arbiter","DOMEvent","DOMEventListener","DOMQuery","PlatformDialogClient","Plugin","PluginReturn"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('DOMEvent'),i=b('DOMEventListener'),j=b('DOMQuery'),k=b('PlatformDialogClient'),l=b('Plugin'),m=b('PluginReturn'),n={redirect:function(o){window.parent.location.replace(o);},submit:function(o){o.submit();},registration:function(o,p){i.add(o,'click',n.redirect.bind(null,p));},connect:function(o){i.add(o,'click',n.submit.bind(null,j.find(o,'^form')));},logout:function(o){i.add(o,'click',n.submit.bind(null,j.find(o,'^form')));},oauth:function(o,p,q,r){g.subscribe(l.RELOAD,function(event,s){m.reload('/plugins/login_button'+(s.crossFrame?'':'?ret=perms'));});this.action(o,function(event){new h(event).kill();var s={scope:q,response_type:'none',redirect_uri:r};k.popup('oauth',p,s);});},action:function(o,p){i.add(o,'click',p);i.add(o,'keydown',function(q){q=new h(q);var r=q.event.which||q.event.keyCode;if(r===32||r===13)p(q);});}};e.exports=n;});
__d("PluginResize",["Log","UnverifiedXD","copyProperties"],function(a,b,c,d,e,f){var g=b('Log'),h=b('UnverifiedXD'),i=b('copyProperties');function j(m){m=m||document.body;return m.offsetWidth+m.offsetLeft;}function k(m){m=m||document.body;return m.offsetHeight+m.offsetTop;}function l(m,n,event,o){this.calcWidth=m||j;this.calcHeight=n||k;this.width=undefined;this.height=undefined;this.reposition=!!o;this.event=event||'resize';}i(l.prototype,{resize:function(){var m=this.calcWidth(),n=this.calcHeight();if(m!==this.width||n!==this.height){g.debug('Resizing Plugin: (%s, %s, %s, %s)',m,n,this.event,this.reposition);this.width=m;this.height=n;h.send({type:this.event,width:m,height:n,reposition:this.reposition});}return this;},auto:function(m){setInterval(this.resize.bind(this),m||250);return this;}});l.auto=function(m,event,n){return new l(j.bind(null,m),k.bind(null,m),event).resize().auto(n);};l.autoHeight=function(m,n,event,o){return new l(function(){return m;},k.bind(null,n),event).resize().auto(o);};e.exports=l;});
__d("PluginSendX",["Arbiter","CSS","DOM","DOMDimensions","DOMEvent","DOMEventListener","DOMPosition","Focus","Plugin","PluginOptin","PluginResize","Style","copyProperties","csx","cx"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('CSS'),i=b('DOM'),j=b('DOMDimensions'),k=b('DOMEvent'),l=b('DOMEventListener'),m=b('DOMPosition'),n=b('Focus'),o=b('Plugin'),p=b('PluginOptin'),q=b('PluginResize'),r=b('Style'),s=b('copyProperties'),t=b('csx'),u=b('cx'),v=function(w,x,y,z,aa,ba){if(!z){var ca=new p('send').addReturnParams({act:'send'});l.add(x,'click',ca.start.bind(ca));return;}var da=false,ea=false;function fa(){ea=!ea;h.toggle(x);h.toggle(y);h.toggle(z);var ga=i.find(z,'.textInput');if(ea){n.set(ga);}else{var ha=i.find(x,'button');n.set(ha);}if(!da){var ia=window.PluginAsyncLoader;ia&&ia.ondemandjs&&ia.run(ia.ondemandjs);da=true;}new q(function(){return Math.max(w.offsetWidth,z.offsetWidth);},function(){return Math.max(w.offsetHeight,z.offsetHeight+z.offsetTop);},'resize.iframe',true).resize();}l.add(x,'click',fa);l.add(y,'click',fa);l.add(w.parentNode,'click',function(ga){ga=new k(ga);if(ga.target===w.parentNode){ga.kill();fa();}});g.subscribe(v.CLOSE,fa);g.subscribe(o.ERROR,function(event,ga){i.setContent(w,ga.content);fa();});g.subscribe('Connect.Unsafe.xd/reposition',function(ga,ha){h.toggleClass(w,"_4-nd");var ia=i.find(z,"._4xn8"),ja=i.find(w,'.pluginButtonPressed .pluginButtonIcon'),ka=(ha.type==='restore')?6:m.getElementPosition(ja).x+j.getElementDimensions(ja).width/2-6;r.set(ia,'left',ka+'px');});if(aa)new q(function(){return w.offsetWidth;},function(){return w.offsetHeight;}).resize();if(ba)fa();};s(v,{SUCCESS:'platform/plugins/send/success',CLOSE:'platform/plugins/send/close',success:function(){g.inform(this.SUCCESS);}});e.exports=v;});
__d("PluginUITypeahead",["DOMDimensions","DOMPosition","DOMQuery","Tokenizer"],function(a,b,c,d,e,f){var g=b('DOMDimensions'),h=b('DOMPosition'),i=b('DOMQuery'),j=b('Tokenizer');function k(){return i.scry(document.body,'.uiTokenizer').map(function(m){var n=j.getInstance(m);if(!n)return {x:0,y:0};var o=n.getTypeahead().getView(),p=h.getElementPosition(o.getElement()),q=g.getElementDimensions(o.getElement());return {x:p.x+q.width,y:p.y+q.height};});}var l={width:function(){return Math.max.apply(null,k().map(function(m){return m.x;}));},height:function(){return Math.max.apply(null,k().map(function(m){return m.y;}));}};e.exports=l;});
__d("PluginSendFlyout",["Arbiter","DOMEvent","DOMEventListener","DOMQuery","Focus","Form","PluginResize","PluginSendX","PluginUITypeahead","Tokenizer","copyProperties"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('DOMEvent'),i=b('DOMEventListener'),j=b('DOMQuery'),k=b("Focus"),l=b('Form'),m=b('PluginResize'),n=b('PluginSendX'),o=b('PluginUITypeahead'),p=b('Tokenizer'),q=b('copyProperties');function r(){}q(r,{init:function(s){var t=j.find(s,'.uiTokenizer'),u=j.find(s,'.textInput'),v=j.find(s,'.pluginSendFlyoutTextarea'),w=j.find(s,'form'),x=j.find(document.body,'.pluginSend'),y=j.find(w,'.pluginSendFlyoutCancelButton');function z(){p.getInstance(t).reset();v.value='';k.setWithoutOutline(x);g.inform(n.CLOSE);}i.add(w,'submit',function(aa){new h(aa).kill();l.bootstrap(w);});i.add(y,'click',function(aa){new h(aa).kill();z();});i.add(y,'keydown',function(aa){aa=new h(aa);var ba=aa.event.keyCode||aa.event.which;if(ba==9&&!aa.event.shiftKey){aa.preventDefault();k.set(u);}});i.add(u,'keydown',function(aa){aa=new h(aa);var ba=aa.event.keyCode||aa.event.which;if(ba==9&&aa.event.shiftKey){aa.preventDefault();if(u.getAttribute('aria-expanded')=='true'){u.setAttribute('aria-expanded','false');}else k.set(y);}});i.add(w,'keyup',function(aa){aa=new h(aa);var ba=aa.event.keyCode||aa.event.which;if(ba==27)z();});g.subscribe(n.SUCCESS,z);new m(function(){return Math.max(x.offsetWidth,s.offsetWidth,o.width());},function(){return Math.max(x.offsetHeight,s.offsetHeight+s.offsetTop,o.height());},'resize.iframe',false).resize().auto();}});e.exports=r;});